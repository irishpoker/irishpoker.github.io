<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards</title>
    <link rel="stylesheet" href="libs/deck-of-cards/example/example.css">
</head>
<body>
    <div id="container"></div>
    <script src="libs/deck-of-cards/dist/deck.min.js"></script>
    <script>
        const $container = document.getElementById('container');
        const maxWidth = window.innerWidth;
        const maxHeight = window.innerHeight;

        const scaleCoords = (coord) => ({
            x: coord.x * (maxWidth / 1920),
            y: coord.y * (maxHeight / 1080)
        });

        const playerCoords = {
            1: [
                {x: -200, y: -350}, {x: -100, y: -350}, {x: 0, y: -350}, {x: 100, y: -350},
                {x: -850, y: 200}, {x: -750, y: 200}, {x: -850, y: 75}, {x: -750, y: 75},
                {x: -850, y: -50}, {x: -750, y: -50}, {x: -850, y: -175}, {x: -750, y: -175}
            ],
            2: [
                {x: -200, y: -350}, {x: -100, y: -350}, {x: 0, y: -350}, {x: 100, y: -350},
                {x: -200, y: 350}, {x: -100, y: 350}, {x: 0, y: 350}, {x: 100, y: 350},
                {x: -850, y: 200}, {x: -750, y: 200}, {x: -850, y: 75}, {x: -750, y: 75},
                {x: -850, y: -50}, {x: -750, y: -50}, {x: -850, y: -175}, {x: -750, y: -175}
            ],
            3: [
                {x: -200, y: -350}, {x: -100, y: -350}, {x: 0, y: -350}, {x: 100, y: -350},
                {x: 500, y: 0}, {x: 600, y: 0}, {x: 700, y: 0}, {x: 800, y: 0},
                {x: -200, y: 350}, {x: -100, y: 350}, {x: 0, y: 350}, {x: 100, y: 350},
                {x: -850, y: 200}, {x: -750, y: 200}, {x: -850, y: 75}, {x: -750, y: 75},
                {x: -850, y: -50}, {x: -750, y: -50}, {x: -850, y: -175}, {x: -750, y: -175}
            ]
        };

        const deckCoords = scaleCoords({ x: 800, y: 350 });

        const riggedCard = () => {
            const values = [1, 7, 8, 9, 10, 11, 12, 13];
            return values[Math.floor(Math.random() * values.length)];
        };

        const deck = Deck(true);
        deck.mount($container);

        const getGameType = () => {
            let game;
            do {
                game = prompt("Which game? (IrishPoker, rigged, or AcesAndKings)").toLowerCase().trim();
            } while (!["irishpoker", "irish poker", "acesandkings", "rigged", "aces and kings"].includes(game));
            return game;
        };

        const getPlayerCount = () => {
            let players;
            do {
                players = prompt("How many players? (Enter 1 through 3)");
            } while (!["1", "2", "3"].includes(players));
            return parseInt(players);
        };

        const animateCards = (cards, coords, delayFactor) => {
            cards.forEach((card, i) => {
                card.enableFlipping();
                card.enableDragging();
                card.animateTo({
                    delay: 1000 + i ** delayFactor,
                    duration: 500,
                    ease: 'quartOut',
                    x: coords[i].x,
                    y: coords[i].y
                });
            });
        };

        const setupGame = (game, players) => {
            const coords = playerCoords[players].map(scaleCoords);
            deck.shuffle();
            deck.shuffle();
            deck.shuffle();
            deck.shuffle();
            deck.shuffle();

            setTimeout(() => {
                animateCards(deck.cards, Array(deck.cards.length).fill(deckCoords), 1.5);
            }, 3000);

            setTimeout(() => {
                animateCards(deck.cards.slice(0, coords.length), coords, 2.5);
            }, 5000);

            if (game === "acesandkings" || game === "aces and kings") {
                deck.cards.forEach(card => {
                    card.rank = Math.random() < 0.5 ? 13 : 1;
                    card.suit = Math.floor(Math.random() * 4);
                });
            } else if (game === "rigged") {
                deck.cards.forEach(card => {
                    card.rank = riggedCard();
                });
            }
        };

        const game = getGameType();
        const players = getPlayerCount();
        setupGame(game, players);
    </script>
</body>
</html>
